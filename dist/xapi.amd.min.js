(function(){define("xapi/system/logger",[],function(){"use strict";var e={log:function(e){console.log(e)},error:function(e){console.error(e)},warn:function(e){console.warn(e)}};return e}),define("xapi/system/date",["xapi/system/logger"],function(e){"use strict";function t(e){var t=String(e);return t.length===1&&(t="0"+t),t}return Date.prototype.toISOString||(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}),Date.isDate=function(t){var n;return Object.prototype.toString.call(t)==="[object Date]"?n=t:n=new Date(t),Object.prototype.toString.call(n)==="[object Date]"?isNaN(n.valueOf())?(e.log("Invalid date String passed"),null):n:(e.log("Invalid date object"),null)},Date.dateFromISOString=function(e){var t="([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T| ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",n=e.match(new RegExp(t)),r=0,i=new Date(n[1],0,1);n[3]&&i.setMonth(n[3]-1),n[5]&&i.setDate(n[5]),n[7]&&i.setHours(n[7]),n[8]&&i.setMinutes(n[8]),n[10]&&i.setSeconds(n[10]),n[12]&&i.setMilliseconds(Number("0."+n[12])*1e3),n[14]&&(r=Number(n[16])*60+Number(n[17]),r*=n[15]=="-"?1:-1),r-=i.getTimezoneOffset();var s=Number(i)+r*60*1e3,o=new Date;return o.setTime(Number(s)),o},Date}),define("xapi/system/coding",[],function(){"use strict";var e={encodeBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},decodeBase64:function(e){return decodeURIComponent(escape(window.atob(e)))},toSHA1:function(e){return CryptoJS&&CryptoJS.SHA1?CryptoJS.SHA1(e).toString():Crypto.util.bytesToHex(Crypto.SHA1(e,{asBytes:!0}))},ruuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})}};return e}),function(e){define("cryptojs.core",[],function(){return function(){var t=t||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],n!=t?this.sigBytes=n:this.sigBytes=e.length*4},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;this.clamp();if(r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=o<<24-(r+s)%4*8}else if(n.length>65535)for(var s=0;s<i;s+=4)t[r+s>>>2]=n[s>>>2];else t.push.apply(t,n);return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){var n=[];for(var r=0;r<t;r+=4)n.push(e.random()*4294967296|0);return new s.init(n,t)}}),o=n.enc={},u=o.Hex={stringify:function(e){var t=e.words,n=e.sigBytes,r=[];for(var i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((s&15).toString(16))}return r.join("")},parse:function(e){var t=e.length,n=[];for(var r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},a=o.Latin1={stringify:function(e){var t=e.words,n=e.sigBytes,r=[];for(var i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){var t=e.length,n=[];for(var r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-r%4*8;return new s.init(n,t)}},f=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,u=o*4,a=i/u;t?a=e.ceil(a):a=e.max((a|0)-this._minBufferSize,0);var f=a*o,l=e.min(f*4,i);if(f){for(var c=0;c<f;c+=o)this._doProcessBlock(r,c);var h=r.splice(0,f);n.sigBytes-=l}return new s.init(h,l)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),c=r.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}}),h=n.algo={};return n}(Math);return e.CryptoJS=t}.apply(e,arguments)})}(this),function(e){define("cryptojs.base64",["cryptojs.core"],function(){return function(){return function(){var e=CryptoJS,t=e.lib,n=t.WordArray,r=e.enc,i=r.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();var i=[];for(var s=0;s<n;s+=3){var o=t[s>>>2]>>>24-s%4*8&255,u=t[s+1>>>2]>>>24-(s+1)%4*8&255,a=t[s+2>>>2]>>>24-(s+2)%4*8&255,f=o<<16|u<<8|a;for(var l=0;l<4&&s+l*.75<n;l++)i.push(r.charAt(f>>>6*(3-l)&63))}var c=r.charAt(64);if(c)while(i.length%4)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,i=r.charAt(64);if(i){var s=e.indexOf(i);s!=-1&&(t=s)}var o=[],u=0;for(var a=0;a<t;a++)if(a%4){var f=r.indexOf(e.charAt(a-1))<<a%4*2,l=r.indexOf(e.charAt(a))>>>6-a%4*2;o[u>>>2]|=(f|l)<<24-u%4*8,u++}return n.create(o,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.CryptoJS=CryptoJS}.apply(e,arguments)})}(this),function(e){define("cryptojs.sha1",["cryptojs.core"],function(){return function(){return function(){var e=CryptoJS,t=e.lib,n=t.WordArray,r=t.Hasher,i=e.algo,s=[],o=i.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){var n=this._hash.words,r=n[0],i=n[1],o=n[2],u=n[3],a=n[4];for(var f=0;f<80;f++){if(f<16)s[f]=e[t+f]|0;else{var l=s[f-3]^s[f-8]^s[f-14]^s[f-16];s[f]=l<<1|l>>>31}var c=(r<<5|r>>>27)+a+s[f];f<20?c+=(i&o|~i&u)+1518500249:f<40?c+=(i^o^u)+1859775393:f<60?c+=(i&o|i&u|o&u)-1894007588:c+=(i^o^u)-899497514,a=u,u=o,o=i<<30|i>>>2,i=r,r=c}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+u|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=this._nDataBytes*8,r=e.sigBytes*8;return t[r>>>5]|=128<<24-r%32,t[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),t[(r+64>>>9<<4)+15]=n,e.sigBytes=t.length*4,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=r._createHelper(o),e.HmacSHA1=r._createHmacHelper(o)}(),e.CryptoJS=CryptoJS}.apply(e,arguments)})}(this),define("xapi/xapiwrapper.js",["xapi/system/date","xapi/system/coding","xapi/system/logger","cryptojs.base64","cryptojs.sha1"],function(e,t,n,r){"use strict";function i(){try{return this.lrs.endpoint!==undefined&&this.lrs.endpoint!==""}catch(e){return!1}}function s(){var e,t,n,r,i,s;e=window.location.href.split("?");if(e.length===2){t=e[1],n=t.split("&"),s={};for(i=0;i<n.length;i+=1)r=n[i].split("="),r.length===2&&r[0]&&(s[r[0]]=decodeURIComponent(r[1]))}return s}function o(e,t){var r;for(var i in t){r=t[i],n.log(i+" : "+r);try{t[i].constructor===Object?e[i]=o(e[i],t[i]):(e===undefined&&(e={}),e[i]=t[i])}catch(s){e===undefined&&(e={}),e[i]=t[i]}}return e}function u(e){var t=["endpoint","auth","actor","registration","activity_id","grouping","activity_platform"],n={},r,i,u;r=s();if(r!==undefined&&Object.keys(r).length!==0){for(u=0;u<t.length;u+=1)i=t[u],r[i]&&(n[i]=r[i],delete r[i]);Object.keys(r).length!==0&&(n.extended=r),n=o(e,n)}else n=e;return n}function a(){var e=new XMLHttpRequest,n=window.location+"?forcenocache="+t.ruuid();e.open("GET",n,!1),e.send(null)}function f(e,t,n,r){var i=t,s=[],o=i.indexOf("?");o>0&&(s.push(i.substr(o+1)),i=i.substr(0,o)),i=i+"?method="+e;if(n!==null)for(var u in n)s.push(u+"="+encodeURIComponent(n[u]));return r!==null&&s.push("content="+encodeURIComponent(r)),{method:"POST",url:i,headers:{},data:s.join("&")}}function c(e,t){function s(e){var t=document.createElement("a");t.href=e;if(t.protocol&&t.host)return t.protocol+"//"+t.host;n.log("Couldn't create base url from endpoint: "+this.lrs.endpoint)}this.lrs=u(e||{}),this.lrs.user&&this.lrs.password&&this.updateAuth(this.lrs,this.lrs.user,this.lrs.password),this.base=s(this.lrs.endpoint),t&&i.call(this)&&this.xhrRequest(this.lrs,this.lrs.endpoint+"about","GET",null,null,function(e){if(e.status===200)try{var t=JSON.parse(e.response),r=!1;for(var i in t.version)if(t.version[i]===c.version){r=!0;break}r||n.log("The lrs version ["+t.version+"]"+" does not match this wrapper's XAPI version ["+c.version+"]")}catch(s){n.log("The response was not an about object")}else n.log("The request to get information about the LRS failed: "+e)}),this.searchParams=function(){var e={format:"exact"};return e},this.hash=function(e){if(!e)return null;try{return r.SHA1(e)}catch(t){return n.log("Error trying to hash -- "+t),null}},this.changeConfig=function(e){try{n.log("updating lrs object with new configuration"),this.lrs=o(this.lrs,e),e.user&&e.password&&this.updateAuth(this.lrs,e.user,e.password),this.base=s(this.lrs.endpoint)}catch(t){n.log("error while changing configuration -- "+t)}}}var l={endpoint:"http://localhost:8000/xapi/",auth:"Basic "+t.encodeBase64("tom:1234")};return c.version="1.0.1",c.prototype.updateAuth=function(e,t,n){return e.auth="Basic "+r.Base64(t+":"+n),e},c.prototype.prepareStatement=function(e){e.actor===undefined?e.actor=JSON.parse(this.lrs.actor):typeof e.actor=="string"&&(e.actor=JSON.parse(e.actor));if(this.lrs.grouping||this.lrs.registration||this.lrs.activity_platform)e.context||(e.context={});this.lrs.grouping&&(e.context.contextActivities||(e.context.contextActivities={}),e.context.contextActivities.grouping=[{id:this.lrs.grouping}]),this.lrs.registration&&(e.context.registration=this.lrs.registration),this.lrs.activity_platform&&(e.context.platform=this.lrs.activity_platform)},c.prototype.testConfig=i,c.prototype.log=log,c.prototype.sendStatement=function(e,n){if(this.testConfig()){this.prepareStatement(e);var r;e.id?r=e.id:(r=t.ruuid(),e.id=r);var i=this.xhrRequest(this.lrs,this.lrs.endpoint+"statements","POST",JSON.stringify(e),this.lrs.auth,n,{id:r});if(!n)return{xhr:i,id:r}}},c.prototype.sendStatements=function(e,t){if(this.testConfig()){for(var n in e)this.prepareStatement(e[n]);var r=this.xhrRequest(this.lrs,this.lrs.endpoint+"statements","POST",JSON.stringify(e),this.lrs.auth,t);if(!t)return r}},c.prototype.getStatements=function(t,n,r){if(this.testConfig()){var i=this.lrs.endpoint+"statements";if(n)i=this.base+n;else{var s=[];for(var o in t)if(o==="until"||o==="since"){var u=new e(t[o]);s.push(o+"="+encodeURIComponent(u.toISOString()))}else s.push(o+"="+encodeURIComponent(t[o]));s.length>0&&(i=i+"?"+s.join("&"))}var a=this.xhrRequest(this.lrs,i,"GET",null,this.lrs.auth,r);if(a===undefined||a.status===404)return null;try{return JSON.parse(a.response)}catch(f){return a.response}}},c.prototype.getActivities=function(e,t){if(this.testConfig()){var n=this.lrs.endpoint+"activities?activityId=<activityid>";n=n.replace("<activityid>",encodeURIComponent(e));var r=this.xhrRequest(this.lrs,n,"GET",null,this.lrs.auth,t,null,!0);if(r===undefined||r.status===404)return null;try{return JSON.parse(r.response)}catch(i){return r.response}}},c.prototype.sendState=function(e,t,r,i,s,o,u,a){if(this.testConfig()){var f=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>";f=f.replace("<activity ID>",encodeURIComponent(e)),f=f.replace("<agent>",encodeURIComponent(JSON.stringify(t))),f=f.replace("<stateid>",encodeURIComponent(r)),i&&(f+="&registration="+encodeURIComponent(i));var l=null;o&&u?log("Can't have both If-Match and If-None-Match"):o?l={"If-Match":'"'+o+'"'}:u&&(l={"If-None-Match":'"'+u+'"'});var c="PUT";if(!s)return n.log("No activity state was included."),!1;Array.isArray(s)?(s=JSON.stringify(s),l=l||{},l["Content-Type"]="application/json"):s instanceof Object?(s=JSON.stringify(s),l=l||{},l["Content-Type"]="application/json",c="POST"):(l=l||{},l["Content-Type"]="application/octet-stream"),this.xhrRequest(this.lrs,f,c,s,this.lrs.auth,a,null,null,l)}},c.prototype.getState=function(e,t,n,r,i,s){if(this.testConfig()){var o=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>";o=o.replace("<activity ID>",encodeURIComponent(e)),o=o.replace("<agent>",encodeURIComponent(JSON.stringify(t))),n&&(o+="&stateId="+encodeURIComponent(n)),r&&(o+="&registration="+encodeURIComponent(r)),i&&(i=isDate(i),i!=null&&(o+="&since="+encodeURIComponent(i.toISOString())));var u=this.xhrRequest(this.lrs,o,"GET",null,this.lrs.auth,s,null,!0);if(u===undefined||u.status===404)return null;try{return JSON.parse(u.response)}catch(a){return u.response}}},c.prototype.deleteState=function(e,t,r,i,s,o,u){if(this.testConfig()){var a=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>";a=a.replace("<activity ID>",encodeURIComponent(e)),a=a.replace("<agent>",encodeURIComponent(JSON.stringify(t))),a=a.replace("<stateid>",encodeURIComponent(r)),i&&(a+="&registration="+encodeURIComponent(i));var f=null;s&&o?n.log("Can't have both If-Match and If-None-Match"):s?f={"If-Match":'"'+s+'"'}:o&&(f={"If-None-Match":'"'+o+'"'});var l=this.xhrRequest(this.lrs,a,"DELETE",null,this.lrs.auth,u,null,f);if(l===undefined||l.status===404)return null;try{return JSON.parse(l.response)}catch(c){return l}}},c.prototype.sendActivityProfile=function(e,t,r,i,s,o){if(this.testConfig()){var u=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>";u=u.replace("<activity ID>",encodeURIComponent(e)),u=u.replace("<profileid>",encodeURIComponent(t));var a=null;i&&s?n.log("Can't have both If-Match and If-None-Match"):i?a={"If-Match":'"'+i+'"'}:s&&(a={"If-None-Match":'"'+s+'"'});var f="PUT";if(!r)return n.log("No activity profile was included."),!1;Array.isArray(r)?(r=JSON.stringify(r),a=a||{},a["Content-Type"]="application/json"):r instanceof Object?(r=JSON.stringify(r),a=a||{},a["Content-Type"]="application/json",f="POST"):(a=a||{},a["Content-Type"]="application/octet-stream"),this.xhrRequest(this.lrs,u,f,r,this.lrs.auth,o,null,!1,a)}},c.prototype.getActivityProfile=function(e,t,n,r){if(this.testConfig()){var i=this.lrs.endpoint+"activities/profile?activityId=<activity ID>";i=i.replace("<activity ID>",encodeURIComponent(e)),t&&(i+="&profileId="+encodeURIComponent(t)),n&&(n=isDate(n),n!=null&&(i+="&since="+encodeURIComponent(n.toISOString())));var s=this.xhrRequest(this.lrs,i,"GET",null,this.lrs.auth,r,null,!0);if(s===undefined||s.status===404)return null;try{return JSON.parse(s.response)}catch(o){return s.response}}},c.prototype.deleteActivityProfile=function(e,t,r,i,s){if(this.testConfig()){var o=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>";o=o.replace("<activity ID>",encodeURIComponent(e)),o=o.replace("<profileid>",encodeURIComponent(t));var u=null;r&&i?n.log("Can't have both If-Match and If-None-Match"):r?u={"If-Match":'"'+r+'"'}:i&&(u={"If-None-Match":'"'+i+'"'});var a=this.xhrRequest(this.lrs,o,"DELETE",null,this.lrs.auth,s,null,u);if(a===undefined||a.status===404)return null;try{return JSON.parse(a.response)}catch(f){return a}}},c.prototype.getAgents=function(e,t){if(this.testConfig()){var n=this.lrs.endpoint+"agents?agent=<agent>";n=n.replace("<agent>",encodeURIComponent(JSON.stringify(e)));var r=this.xhrRequest(this.lrs,n,"GET",null,this.lrs.auth,t,null,!0);if(r===undefined||r.status===404)return null;try{return JSON.parse(r.response)}catch(i){return r.response}}},c.prototype.sendAgentProfile=function(e,t,r,i,s,o){if(this.testConfig()){var u=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>";u=u.replace("<agent>",encodeURIComponent(JSON.stringify(e))),u=u.replace("<profileid>",encodeURIComponent(t));var a=null;i&&s?n.log("Can't have both If-Match and If-None-Match"):i?a={"If-Match":'"'+i+'"'}:s&&(a={"If-None-Match":'"'+s+'"'});var f="PUT";if(!r)return n.log("No agent profile was included."),!1;r instanceof Array?(r=JSON.stringify(r),a=a||{},a["Content-Type"]="application/json"):r instanceof Object?(r=JSON.stringify(r),a=a||{},a["Content-Type"]="application/json",f="POST"):(a=a||{},a["Content-Type"]="application/octet-stream"),this.xhrRequest(this.lrs,u,f,r,this.lrs.auth,o,null,!1,a)}},c.prototype.getAgentProfile=function(e,t,n,r){if(this.testConfig()){var i=this.lrs.endpoint+"agents/profile?agent=<agent>";i=i.replace("<agent>",encodeURIComponent(JSON.stringify(e))),i=i.replace("<profileid>",encodeURIComponent(t)),t&&(i+="&profileId="+encodeURIComponent(t)),n&&(n=isDate(n),n!=null&&(i+="&since="+encodeURIComponent(n.toISOString())));var s=this.xhrRequest(this.lrs,i,"GET",null,this.lrs.auth,r,null,!0);if(s===undefined||s.status===404)return null;try{return JSON.parse(s.response)}catch(o){return s.response}}},c.prototype.deleteAgentProfile=function(e,t,r,i,s){if(this.testConfig()){var o=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>";o=o.replace("<agent>",encodeURIComponent(JSON.stringify(e))),o=o.replace("<profileid>",encodeURIComponent(t));var u=null;r&&i?n.log("Can't have both If-Match and If-None-Match"):r?u={"If-Match":'"'+r+'"'}:i&&(u={"If-None-Match":'"'+i+'"'});var a=this.xhrRequest(this.lrs,o,"DELETE",null,this.lrs.auth,s,null,u);if(a===undefined||a.status===404)return null;try{return JSON.parse(a.response)}catch(f){return a}}},c.prototype.xhrRequest=function(t,r,i,s,o,u,l,h,p){function L(){if(!!v)return S;v=!0;var e=h&&d.status===404;if(!(d.status===undefined||d.status>=200&&d.status<400||e)){var o;try{o="There was a problem communicating with the Learning Record Store. ( "+d.status+" | "+d.response+" )"+r}catch(a){o=a.toString()}return n.log(o),this.xhrRequestOnError(d,i,r,u,l),S=d,d}if(!u)return S=d,d;if(l)u(d,l);else try{var t=JSON.parse(d.responseText);u(d,t)}catch(s){u(d,d.responseText)}}var d,v=!1,m=!1,g=!1,y,b=r.toLowerCase().match(/^(.+):\/\/([^:\/]*):?(\d+)?(\/.*)?$/),w=window.location,E,S,x,T,N,C={};C["Content-Type"]="application/json",C.Authorization=o,C["X-Experience-API-Version"]=c.version;if(p!==null)for(var k in p)C[k]=p[k];m=w.protocol.toLowerCase()!==b[1]||w.hostname.toLowerCase()!==b[2],m||(E=b[3]===null?b[1]==="http"?"80":"443":b[3],m=E===w.port);if(!m||typeof XDomainRequest=="undefined"){d=new XMLHttpRequest,d.open(i,r,u!=null);for(var k in C)d.setRequestHeader(k,C[k])}else g=!0,y=f(i,r,C,s),d=new XDomainRequest,d.open(y.method,y.url);d.onreadystatechange=function(){if(d.readyState===4)return L()},d.onload=L,d.onerror=L,d.send(g?y.data:s);if(!u){if(g){N=1e3+new e;while(new e<N&&d.readyState!==4&&!v)a()}return L()}},c.prototype.xhrRequestOnError=function(e,t,r,i,s){n.error(t,r,s)},new c(l,!1)})})();